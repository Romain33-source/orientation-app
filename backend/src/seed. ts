import { DataSource } from 'typeorm';
import * as bcrypt from 'bcrypt';
import { User, UserRole } from './users/entities/user.entity';
import { Profession } from './professions/entities/profession.entity';
import { Quiz } from './quiz/entities/quiz.entity';

const AppDataSource = new DataSource({
  type: 'postgres',
  host: process.env.DATABASE_HOST || 'localhost',
  port: parseInt(process.env.DATABASE_PORT) || 5432,
  username: process.env.DATABASE_USER || 'postgres',
  password: process.env.DATABASE_PASSWORD || 'password',
  database: process.env.DATABASE_NAME || 'orientation_db',
  entities: [User, Profession, Quiz, __dirname + '/**/*.entity{.ts,.js}'],
  synchronize: true,
});

async function seed() {
  console.log('ğŸŒ± DÃ©but du seed...');

  await AppDataSource.initialize();
  console.log('âœ… Connexion Ã  la base de donnÃ©es Ã©tablie');

  const userRepo = AppDataSource.getRepository(User);
  const professionRepo = AppDataSource.getRepository(Profession);
  const quizRepo = AppDataSource.getRepository(Quiz);

  // 1. CrÃ©er les utilisateurs
  console. log('ğŸ‘¤ CrÃ©ation des utilisateurs.. .');
  
  const hashedPassword = await bcrypt.hash('password123', 10);

  const eleve = await userRepo.save({
    email: 'eleve@test.fr',
    password: hashedPassword,
    firstName: 'Lucas',
    lastName: 'Martin',
    role: UserRole. ELEVE,
    classe: '3Ã¨me',
    etablissement: 'CollÃ¨ge Victor Hugo',
  });

  const parent = await userRepo.save({
    email: 'parent@test.fr',
    password: hashedPassword,
    firstName: 'Sophie',
    lastName: 'Martin',
    role: UserRole. PARENT,
  });

  const pro = await userRepo.save({
    email: 'pro@test.fr',
    password: hashedPassword,
    firstName: 'Jean',
    lastName: 'Dupont',
    role: UserRole.PROFESSIONNEL,
    profession: 'DÃ©veloppeur Web',
  });

  console.log('âœ… 3 utilisateurs crÃ©Ã©s');

  // 2. CrÃ©er les professions
  console.log('ğŸ’¼ CrÃ©ation des professions.. .');

  const professions = [
    {
      titre: 'DÃ©veloppeur Web',
      description: 'ConÃ§oit et dÃ©veloppe des sites web et applications.  MaÃ®trise les langages de programmation.',
      competencesRequises: 'HTML, CSS, JavaScript, Problem solving, Logique',
      formations: 'Bac+2 Ã  Bac+5 en informatique, Ã‰cole 42, OpenClassrooms',
      salaireMin: 30000,
      salaireMax: 55000,
      secteurs: ['Informatique', 'Digital', 'Tech'],
      interets: ['scientifique', 'technique', 'logique'],
    },
    {
      titre: 'Infirmier(Ã¨re)',
      description: 'Soigne et accompagne les patients. Travaille en hÃ´pital, clinique ou Ã  domicile.',
      competencesRequises: 'Empathie, RÃ©sistance au stress, Rigueur, Communication',
      formations: 'DiplÃ´me d\'Ã‰tat d\'Infirmier (Bac+3)',
      salaireMin: 25000,
      salaireMax: 40000,
      secteurs: ['SantÃ©', 'Social'],
      interets: ['social', 'aide', 'scientifique'],
    },
    {
      titre: 'Architecte',
      description: 'ConÃ§oit des bÃ¢timents et supervise leur construction. Allie crÃ©ativitÃ© et technique.',
      competencesRequises: 'Dessin, CrÃ©ativitÃ©, MathÃ©matiques, Gestion de projet',
      formations: 'Bac+5 Ã‰cole d\'Architecture',
      salaireMin: 28000,
      salaireMax: 60000,
      secteurs: ['BTP', 'Design', 'Urbanisme'],
      interets: ['artistique', 'technique', 'scientifique'],
    },
    {
      titre: 'Chef Cuisinier',
      description: 'Dirige une cuisine, crÃ©e des plats et manage une Ã©quipe. Passion et crÃ©ativitÃ©.',
      competencesRequises: 'CrÃ©ativitÃ© culinaire, Management, RÃ©sistance physique',
      formations: 'CAP Cuisine, BP, Mention ComplÃ©mentaire',
      salaireMin: 22000,
      salaireMax: 45000,
      secteurs: ['HÃ´tellerie-Restauration', 'Gastronomie'],
      interets: ['artistique', 'manuel', 'entrepreneurial'],
    },
    {
      titre: 'Professeur des Ã‰coles',
      description: 'Enseigne toutes les matiÃ¨res aux Ã©lÃ¨ves de maternelle et primaire.',
      competencesRequises: 'PÃ©dagogie, Patience, Communication, Culture gÃ©nÃ©rale',
      formations: 'Master MEEF + Concours CRPE',
      salaireMin: 26000,
      salaireMax: 38000,
      secteurs: ['Ã‰ducation', 'Enseignement'],
      interets: ['social', 'enseignement', 'communication'],
    },
    {
      titre: 'MÃ©canicien Automobile',
      description: 'RÃ©pare et entretient les vÃ©hicules. Diagnostique les pannes.',
      competencesRequises: 'MÃ©canique, DextÃ©ritÃ©, Diagnostic, PrÃ©cision',
      formations: 'CAP, Bac Pro Maintenance vÃ©hicules',
      salaireMin: 20000,
      salaireMax: 35000,
      secteurs: ['Automobile', 'Maintenance'],
      interets: ['technique', 'manuel', 'logique'],
    },
    {
      titre: 'Graphiste Designer',
      description: 'CrÃ©e des visuels pour supports print et web. IdentitÃ© visuelle de marques.',
      competencesRequises: 'CrÃ©ativitÃ©, MaÃ®trise logiciels PAO, Sens artistique',
      formations: 'BTS Design Graphique, Ã‰cole d\'Art',
      salaireMin: 24000,
      salaireMax: 42000,
      secteurs: ['Communication', 'Design', 'Digital'],
      interets: ['artistique', 'crÃ©atif', 'visuel'],
    },
    {
      titre: 'Ã‰ducateur SpÃ©cialisÃ©',
      description: 'Accompagne personnes en difficultÃ© sociale ou handicap.',
      competencesRequises: 'Empathie, Ã‰coute, PÃ©dagogie, Patience',
      formations: 'DiplÃ´me d\'Ã‰tat d\'Ã‰ducateur SpÃ©cialisÃ© (Bac+3)',
      salaireMin: 24000,
      salaireMax: 35000,
      secteurs: ['Social', 'Ã‰ducation'],
      interets: ['social', 'aide', 'communication'],
    },
    {
      titre: 'VÃ©tÃ©rinaire',
      description: 'Soigne les animaux domestiques et d\'Ã©levage. Chirurgie et consultations.',
      competencesRequises: 'Biologie, Chirurgie, Empathie, Rigueur scientifique',
      formations: 'Bac+7 Ã‰cole Nationale VÃ©tÃ©rinaire',
      salaireMin: 30000,
      salaireMax: 70000,
      secteurs: ['SantÃ© animale', 'Ã‰levage'],
      interets: ['scientifique', 'animaux', 'aide'],
    },
    {
      titre: 'Journaliste',
      description: 'EnquÃªte, rÃ©dige et diffuse des informations pour diffÃ©rents mÃ©dias.',
      competencesRequises: 'Ã‰criture, CuriositÃ©, Investigation, Communication',
      formations: 'Ã‰cole de Journalisme, Master',
      salaireMin: 24000,
      salaireMax: 50000,
      secteurs: ['MÃ©dias', 'Communication', 'Presse'],
      interets: ['communication', 'Ã©criture', 'investigation'],
    },
    {
      titre: 'Ã‰lectricien',
      description: 'Installe et entretient les installations Ã©lectriques.',
      competencesRequises: 'Ã‰lectricitÃ©, SÃ©curitÃ©, Lecture de plans, PrÃ©cision',
      formations: 'CAP Ã‰lectricien, Bac Pro MELEC',
      salaireMin: 22000,
      salaireMax: 38000,
      secteurs: ['BTP', 'Ã‰nergie'],
      interets: ['technique', 'manuel', 'logique'],
    },
    {
      titre: 'Psychologue',
      description: 'Accompagne les personnes en souffrance psychologique.',
      competencesRequises: 'Ã‰coute, Empathie, Analyse, DiscrÃ©tion',
      formations: 'Master en Psychologie (Bac+5)',
      salaireMin: 26000,
      salaireMax: 45000,
      secteurs: ['SantÃ©', 'Social'],
      interets: ['social', 'aide', 'Ã©coute'],
    },
    {
      titre: 'Commercial',
      description: 'Vend des produits ou services.  DÃ©veloppe un portefeuille clients.',
      competencesRequises: 'Communication, Persuasion, NÃ©gociation, Dynamisme',
      formations: 'BTS Commerce, Licence, Ã‰cole de Commerce',
      salaireMin: 24000,
      salaireMax: 60000,
      secteurs: ['Commerce', 'Vente'],
      interets: ['communication', 'relationnel', 'entrepreneurial'],
    },
    {
      titre: 'Data Scientist',
      description: 'Analyse de grandes quantitÃ©s de donnÃ©es pour aider Ã  la dÃ©cision.',
      competencesRequises: 'MathÃ©matiques, Statistiques, Python, Machine Learning',
      formations: 'Bac+5 MathÃ©matiques, Informatique, Data Science',
      salaireMin: 38000,
      salaireMax: 65000,
      secteurs: ['Informatique', 'Data', 'Tech'],
      interets: ['scientifique', 'logique', 'analytique'],
    },
    {
      titre: 'PÃ¢tissier',
      description: 'CrÃ©e gÃ¢teaux, viennoiseries et desserts.  Art et prÃ©cision.',
      competencesRequises: 'CrÃ©ativitÃ©, PrÃ©cision, DextÃ©ritÃ©, Sens du goÃ»t',
      formations: 'CAP PÃ¢tissier, BTM',
      salaireMin: 20000,
      salaireMax: 40000,
      secteurs: ['Artisanat', 'Gastronomie'],
      interets: ['artistique', 'manuel', 'crÃ©atif'],
    },
  ];

  for (const profData of professions) {
    await professionRepo.save({ ...profData, createdBy: pro.id });
  }

  console.log(`âœ… ${professions.length} professions crÃ©Ã©es`);

  // 3. CrÃ©er le quiz
  console.log('ğŸ“ CrÃ©ation du quiz...');

  const quiz = await quizRepo.save({
    titre: 'Quiz d\'Orientation - DÃ©couvre tes intÃ©rÃªts',
    description: 'Ce quiz t\'aide Ã  identifier tes centres d\'intÃ©rÃªt pour mieux choisir ton orientation.',
    isActive: true,
    questions: [
      { id: 'q1', question: 'J\'aime rÃ©soudre des problÃ¨mes mathÃ©matiques', interet: 'scientifique', type: 'echelle' },
      { id: 'q2', question: 'Je prÃ©fÃ¨re crÃ©er des choses avec mes mains', interet: 'manuel', type: 'echelle' },
      { id: 'q3', question: 'J\'adore dessiner et crÃ©er des designs', interet: 'artistique', type: 'echelle' },
      { id: 'q4', question: 'Aider les autres me motive', interet: 'social', type: 'echelle' },
      { id: 'q5', question: 'J\'aime comprendre comment les choses fonctionnent', interet: 'technique', type: 'echelle' },
      { id: 'q6', question: 'Je suis Ã  l\'aise pour parler en public', interet: 'communication', type: 'echelle' },
      { id: 'q7', question: 'Les expÃ©riences scientifiques me passionnent', interet: 'scientifique', type: 'echelle' },
      { id: 'q8', question: 'Je prÃ©fÃ¨re les activitÃ©s physiques et sportives', interet: 'sportif', type: 'echelle' },
      { id: 'q9', question: 'J\'aime Ã©crire des histoires ou articles', interet: 'Ã©criture', type: 'echelle' },
      { id: 'q10', question: 'Monter mon entreprise m\'intÃ©resse', interet: 'entrepreneurial', type: 'echelle' },
      { id: 'q11', question: 'Je suis fascinÃ© par les animaux', interet: 'animaux', type: 'echelle' },
      { id: 'q12', question: 'J\'aime analyser des donnÃ©es et statistiques', interet: 'analytique', type: 'echelle' },
      { id: 'q13', question: 'La musique est une passion pour moi', interet: 'musical', type: 'echelle' },
      { id: 'q14', question: 'RÃ©parer des objets me plaÃ®t', interet: 'technique', type: 'echelle' },
      { id: 'q15', question: 'Je m\'intÃ©resse Ã  la politique et sociÃ©tÃ©', interet: 'social', type: 'echelle' },
      { id: 'q16', question: 'Programmer un ordinateur m\'attire', interet: 'logique', type: 'echelle' },
      { id: 'q17', question: 'J\'aime cuisiner et expÃ©rimenter', interet: 'crÃ©atif', type: 'echelle' },
      { id: 'q18', question: 'Enseigner aux autres me plaÃ®t', interet: 'enseignement', type: 'echelle' },
      { id: 'q19', question: 'Je prÃ©fÃ¨re le travail d\'Ã©quipe', interet: 'relationnel', type: 'echelle' },
      { id: 'q20', question: 'Les enquÃªtes et investigations m\'intÃ©ressent', interet: 'investigation', type: 'echelle' },
    ],
  });

  console.log('âœ… Quiz crÃ©Ã©');

  console.log('\nğŸ‰ SEED TERMINÃ‰ !\n');
  console.log('ğŸ“§ Comptes crÃ©Ã©s :');
  console.log('   - eleve@test.fr / password123');
  console.log('   - parent@test.fr / password123');
  console. log('   - pro@test. fr / password123\n');

  await AppDataSource.destroy();
  process.exit(0);
}

seed().catch((error) => {
  console.error('âŒ Erreur lors du seed:', error);
  process.exit(1);
});
